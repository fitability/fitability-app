@page "/"
@using System.Text.Json
@using System.Text.Json.Serialization
@using Fitability.Web.Models

<PageTitle>Index</PageTitle>

<h1>Hello, world!</h1>

Welcome to your new app.

<SurveyPrompt Title="How is Blazor working for you?" />

<AuthorizeView>
    <Authorized>
        <pre>
            @claims
        </pre>
    </Authorized>
</AuthorizeView>

@code {
    [CascadingParameter]
    private Task<AuthenticationState> authenticationStateTask { get; set; }

    private string? claims;

    protected override async Task OnInitializedAsync()
    {
        var authState = await authenticationStateTask;
        var claims = authState.User.Claims.Select(p => new UserClaimModel { Issuer = p.Issuer, OriginalIssuer = p.OriginalIssuer, Type = p.Type, Value = p.Value }).ToList();
        this.claims = JsonSerializer.Serialize<List<UserClaimModel>>(claims, new JsonSerializerOptions() { WriteIndented = true });
    }
}